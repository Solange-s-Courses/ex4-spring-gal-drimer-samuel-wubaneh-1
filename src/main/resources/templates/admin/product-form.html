<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Form - Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <style>
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f8f9fa;
        }
        .form-section {
            border-left: 4px solid #0d6efd;
            padding-left: 15px;
            margin-bottom: 2rem;
        }
        .required-field {
            color: #dc3545;
        }
        .character-count {
            font-size: 0.875rem;
            color: #6c757d;
        }
        .price-input-group .input-group-text {
            background-color: #e9ecef;
            border-color: #ced4da;
        }
    </style>
</head>
<body>
<!-- Navigation Bar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/admin">Chain Store Admin</a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/admin">Dashboard</a>
            <a class="nav-link" href="/admin/products">Products</a>
            <a class="nav-link" href="/">Public Site</a>
            <a class="nav-link" href="/logout">Logout</a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/admin">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="/admin/products">Products</a></li>
            <li class="breadcrumb-item active" th:text="${product.id == null ? 'Add Product' : 'Edit Product'}">Product Form</li>
        </ol>
    </nav>

    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h4 class="mb-0" th:text="${product.id == null ? 'Add New Product' : 'Edit Product'}">Product Form</h4>
                            <small th:text="${product.id == null ? 'Create a new product for your catalog' : 'Update product information'}">Form description</small>
                        </div>
                        <div th:if="${product.id != null}">
                            <span class="badge bg-light text-dark">ID: <span th:text="${product.id}">1</span></span>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Success/Error Messages -->
                    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                        <span th:text="${successMessage}"></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                        <span th:text="${errorMessage}"></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>

                    <!-- Form Start -->
                    <form th:action="@{/admin/products/save}" method="post" th:object="${product}" id="productForm" novalidate>
                        <input type="hidden" th:field="*{id}">
                        <input type="hidden" th:field="*{createdDate}">

                        <!-- Basic Information Section -->
                        <div class="form-section">
                            <h5 class="text-primary mb-3">Basic Information</h5>

                            <div class="row">
                                <!-- Product Name -->
                                <div class="col-md-8">
                                    <div class="mb-3">
                                        <label for="name" class="form-label">
                                            Product Name <span class="required-field">*</span>
                                        </label>
                                        <input type="text"
                                               class="form-control"
                                               th:class="${#fields.hasErrors('name') ? 'form-control is-invalid' : 'form-control'}"
                                               id="name"
                                               th:field="*{name}"
                                               required
                                               maxlength="100"
                                               placeholder="Enter product name (e.g., Dell XPS 13 Laptop)">
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                                        <div class="form-text">
                                            <span class="character-count" id="nameCount">0/100 characters</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Product Status -->
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">Product Status</label>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="inStock" th:field="*{inStock}">
                                            <label class="form-check-label" for="inStock">
                                                <span class="badge bg-success" id="statusBadge">In Stock</span>
                                            </label>
                                        </div>
                                        <div class="form-text">Toggle product availability</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Barcode -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="barcode" class="form-label">
                                            Barcode/SKU <span class="required-field">*</span>
                                        </label>
                                        <input type="text"
                                               class="form-control"
                                               th:class="${#fields.hasErrors('barcode') or barcodeError != null ? 'form-control is-invalid' : 'form-control'}"
                                               id="barcode"
                                               th:field="*{barcode}"
                                               required
                                               placeholder="Enter unique barcode (e.g., DELL001)">
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('barcode')}" th:errors="*{barcode}"></div>
                                        <div class="invalid-feedback" th:if="${barcodeError}" th:text="${barcodeError}"></div>
                                        <div class="form-text">Unique identifier for the product</div>
                                    </div>
                                </div>

                                <!-- Brand -->
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="brand" class="form-label">Brand</label>
                                        <input list="brands"
                                               class="form-control"
                                               id="brand"
                                               th:field="*{brand}"
                                               placeholder="Enter or select brand">
                                        <datalist id="brands">
                                            <option th:each="brandItem : ${brands}" th:value="${brandItem}">
                                        </datalist>
                                        <div class="form-text">Product manufacturer or brand name</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Category -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="category" class="form-label">
                                            Category <span class="required-field">*</span>
                                        </label>
                                        <input list="categories"
                                               class="form-control"
                                               th:class="${#fields.hasErrors('category') ? 'form-control is-invalid' : 'form-control'}"
                                               id="category"
                                               th:field="*{category}"
                                               required
                                               placeholder="Enter or select category">
                                        <datalist id="categories">
                                            <option th:each="cat : ${categories}" th:value="${cat}">
                                        </datalist>
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('category')}" th:errors="*{category}"></div>
                                        <div class="form-text">Product category for organization</div>
                                    </div>
                                </div>

                                <!-- Weight -->
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="weight" class="form-label">Weight (kg)</label>
                                        <div class="input-group">
                                            <input type="number"
                                                   class="form-control"
                                                   id="weight"
                                                   th:field="*{weight}"
                                                   step="0.1"
                                                   min="0"
                                                   placeholder="0.0">
                                            <span class="input-group-text">kg</span>
                                        </div>
                                        <div class="form-text">Product weight for shipping calculations</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pricing Section -->
                        <div class="form-section">
                            <h5 class="text-success mb-3">Pricing & Inventory</h5>

                            <div class="row">
                                <!-- Price -->
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="price" class="form-label">
                                            Price <span class="required-field">*</span>
                                        </label>
                                        <div class="input-group price-input-group">
                                            <span class="input-group-text">$</span>
                                            <input type="number"
                                                   class="form-control"
                                                   th:class="${#fields.hasErrors('price') ? 'form-control is-invalid' : 'form-control'}"
                                                   id="price"
                                                   th:field="*{price}"
                                                   step="0.01"
                                                   min="0"
                                                   required
                                                   placeholder="0.00">
                                        </div>
                                        <div class="invalid-feedback" th:if="${#fields.hasErrors('price')}" th:errors="*{price}"></div>
                                        <div class="form-text">Product selling price in USD</div>
                                    </div>
                                </div>

                                <!-- Stock Quantity -->
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="stockQuantity" class="form-label">Stock Quantity</label>
                                        <div class="input-group">
                                            <input type="number"
                                                   class="form-control"
                                                   id="stockQuantity"
                                                   th:field="*{stockQuantity}"
                                                   min="0"
                                                   placeholder="0">
                                            <span class="input-group-text">units</span>
                                        </div>
                                        <div class="form-text">
                                            <span id="stockStatus" class="badge bg-secondary">Unknown</span>
                                            Current inventory level
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Description Section -->
                        <div class="form-section">
                            <h5 class="text-info mb-3">Product Description</h5>

                            <div class="mb-3">
                                <label for="description" class="form-label">Description</label>
                                <textarea class="form-control"
                                          id="description"
                                          th:field="*{description}"
                                          rows="6"
                                          maxlength="1000"
                                          placeholder="Enter detailed product description..."></textarea>
                                <div class="form-text">
                                    <span class="character-count" id="descriptionCount">0/1000 characters</span>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="d-flex justify-content-between">
                                    <a href="/admin/products" class="btn btn-secondary">Cancel</a>
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <span th:text="${product.id == null ? 'Create Product' : 'Update Product'}">Save</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Character counters
    document.addEventListener('DOMContentLoaded', function() {
        const nameInput = document.getElementById('name');
        const descriptionInput = document.getElementById('description');
        const nameCount = document.getElementById('nameCount');
        const descriptionCount = document.getElementById('descriptionCount');

        function updateCharacterCount(input, counter, max) {
            if (input && counter) {
                const current = input.value.length;
                counter.textContent = current + '/' + max + ' characters';
            }
        }

        if (nameInput && nameCount) {
            nameInput.addEventListener('input', () => updateCharacterCount(nameInput, nameCount, 100));
            updateCharacterCount(nameInput, nameCount, 100);
        }

        if (descriptionInput && descriptionCount) {
            descriptionInput.addEventListener('input', () => updateCharacterCount(descriptionInput, descriptionCount, 1000));
            updateCharacterCount(descriptionInput, descriptionCount, 1000);
        }
    });

    // Stock status updates
    function updateStockStatus() {
        const quantity = parseInt(document.getElementById('stockQuantity').value) || 0;
        const stockStatus = document.getElementById('stockStatus');

        if (quantity === 0) {
            stockStatus.textContent = 'Out of Stock';
            stockStatus.className = 'badge bg-danger';
        } else if (quantity <= 10) {
            stockStatus.textContent = 'Low Stock';
            stockStatus.className = 'badge bg-warning';
        } else {
            stockStatus.textContent = 'In Stock';
            stockStatus.className = 'badge bg-success';
        }
    }

    // Status badge toggle
    function updateStatusBadge() {
        const inStock = document.getElementById('inStock').checked;
        const statusBadge = document.getElementById('statusBadge');
        if (inStock) {
            statusBadge.textContent = 'In Stock';
            statusBadge.className = 'badge bg-success';
        } else {
            statusBadge.textContent = 'Out of Stock';
            statusBadge.className = 'badge bg-danger';
        }
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
        const stockQuantityInput = document.getElementById('stockQuantity');
        const inStockCheckbox = document.getElementById('inStock');

        if (stockQuantityInput) {
            stockQuantityInput.addEventListener('input', updateStockStatus);
            updateStockStatus();
        }

        if (inStockCheckbox) {
            inStockCheckbox.addEventListener('change', updateStatusBadge);
            updateStatusBadge();
        }
    });

    // Form validation
    document.getElementById('productForm').addEventListener('submit', function(e) {
        const requiredFields = ['name', 'barcode', 'category', 'price'];
        let hasErrors = false;

        requiredFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field && !field.value.trim()) {
                field.classList.add('is-invalid');
                hasErrors = true;
            } else if (field) {
                field.classList.remove('is-invalid');
            }
        });

        if (hasErrors) {
            e.preventDefault();
            alert('Please fill in all required fields.');
        }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>