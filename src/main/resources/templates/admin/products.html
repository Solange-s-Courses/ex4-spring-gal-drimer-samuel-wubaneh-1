<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management - Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
</head>
<body>
<!-- Navigation Bar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/admin">‚öôÔ∏è Chain Store Admin</a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/admin">üìä Dashboard</a>
            <a class="nav-link" href="/">üè† Public Site</a>
            <a class="nav-link" href="/logout">üö™ Logout</a>
        </div>
    </div>
</nav>

<div class="container-fluid mt-4">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-2">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0">üóÇÔ∏è Admin Menu</h6>
                </div>
                <div class="list-group list-group-flush">
                    <a href="/admin" class="list-group-item list-group-item-action">üìä Dashboard</a>
                    <a href="/admin/users" class="list-group-item list-group-item-action">üë• Users</a>
                    <a href="/admin/products" class="list-group-item list-group-item-action active">üì¶ Products</a>
                    <a href="/admin/stores" class="list-group-item list-group-item-action">üè™ Stores</a>
                    <a href="/admin/questions" class="list-group-item list-group-item-action">‚ùì Game Questions</a>
                    <a href="/admin/reviews" class="list-group-item list-group-item-action">üí¨ Reviews</a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-10">
            <!-- Page Header -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <h2>üì¶ Product Management</h2>
                    <p class="text-muted">Manage your product catalog</p>
                </div>
                <div class="col-md-4 text-end">
                    <a href="/admin/products/add" class="btn btn-success">‚ûï Add New Product</a>
                </div>
            </div>

            <!-- Success/Error Messages -->
            <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                <span th:text="${successMessage}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <span th:text="${errorMessage}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <!-- Filters -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">üîç Filter Products</h5>
                </div>
                <div class="card-body">
                    <form method="get" action="/admin/products">
                        <div class="row">
                            <div class="col-md-4">
                                <label for="search" class="form-label">Search</label>
                                <input type="text" class="form-control" id="search" name="search"
                                       th:value="${currentSearch}" placeholder="Product name...">
                            </div>
                            <div class="col-md-4">
                                <label for="category" class="form-label">Category</label>
                                <select class="form-select" id="category" name="category">
                                    <option value="">All Categories</option>
                                    <option th:each="cat : ${categories}"
                                            th:value="${cat}"
                                            th:text="${cat}"
                                            th:selected="${cat == currentCategory}">Category</option>
                                </select>
                            </div>
                            <div class="col-md-4 d-flex align-items-end">
                                <button type="submit" class="btn btn-primary me-2">Apply Filters</button>
                                <a href="/admin/products" class="btn btn-outline-secondary">Clear</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Products Table -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">üì¶ Product List</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Barcode</th>
                                <th>Category</th>
                                <th>Brand</th>
                                <th>Price</th>
                                <th>Stock</th>
                                <th>Reviews</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="product : ${products.content}" th:if="${products != null and !#lists.isEmpty(products.content)}">
                                <td th:text="${product.id}">1</td>
                                <td>
                                    <strong th:text="${product.name}">Product Name</strong><br>
                                    <small class="text-muted" th:text="${#strings.abbreviate(product.description, 50)}">Description...</small>
                                </td>
                                <td>
                                    <code th:text="${product.barcode}">ABC123</code>
                                </td>
                                <td>
                                    <span class="badge bg-secondary" th:text="${product.category}">Category</span>
                                </td>
                                <td th:text="${product.brand ?: '-'}">Brand</td>
                                <td>
                                    <strong class="text-success" th:text="${product.formattedPrice}">$0.00</strong>
                                </td>
                                <td>
                                        <span class="badge"
                                              th:class="${product.inStock ? 'bg-success' : 'bg-danger'}"
                                              th:text="${product.stockStatus}">In Stock</span>
                                    <br>
                                    <small th:text="${product.stockQuantity + ' units'}">0 units</small>
                                </td>
                                <td>
                                    <span class="badge bg-info" th:text="${product.approvedCommentsCount}">0</span>
                                    <span class="text-warning" th:text="${product.averageRating > 0 ? '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ' : '‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ'}">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                                </td>
                                <td th:text="${#temporals.format(product.createdDate, 'MMM dd')}">Date</td>
                                <td>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <!-- View Product -->
                                        <a th:href="@{/products/{id}(id=${product.id})}"
                                           class="btn btn-outline-primary"
                                           title="View Product"
                                           target="_blank">
                                            üëÅÔ∏è
                                        </a>

                                        <!-- Edit Product -->
                                        <a th:href="@{/admin/products/edit/{id}(id=${product.id})}"
                                           class="btn btn-warning"
                                           title="Edit Product">
                                            ‚úèÔ∏è
                                        </a>

                                        <!-- Delete Product -->
                                        <form th:action="@{/admin/products/{id}/delete(id=${product.id})}"
                                              method="post" style="display: inline;">
                                            <button type="submit"
                                                    class="btn btn-danger"
                                                    title="Delete Product"
                                                    onclick="return confirm('Are you sure you want to delete this product?')">
                                                üóëÔ∏è
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            <tr th:if="${products == null or #lists.isEmpty(products.content)}">
                                <td colspan="10" class="text-center text-muted">No products found</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <nav th:if="${products != null and (products.hasPrevious() or products.hasNext())}"
                         aria-label="Product pagination">
                        <ul class="pagination justify-content-center">
                            <li class="page-item" th:class="${products.hasPrevious() ? '' : 'disabled'}">
                                <a class="page-link"
                                   th:href="@{/admin/products(page=${products.number - 1}, search=${currentSearch}, category=${currentCategory})}">
                                    Previous
                                </a>
                            </li>
                            <li class="page-item active">
                                <span class="page-link"
                                      th:text="${products.number + 1} + ' of ' + ${products.totalPages}">1 of 1</span>
                            </li>
                            <li class="page-item" th:class="${products.hasNext() ? '' : 'disabled'}">
                                <a class="page-link"
                                   th:href="@{/admin/products(page=${products.number + 1}, search=${currentSearch}, category=${currentCategory})}">
                                    Next
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

            <!-- Product Statistics -->
            <div class="row mt-4">
                <div class="col-md-4">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="text-primary" th:text="${products != null ? products.totalElements : '0'}">0</h5>
                            <small>Total Products</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="text-success" th:text="${#lists.size(categories)}">0</h5>
                            <small>Categories</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="text-info">0</h5>
                            <small>Low Stock Items</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>