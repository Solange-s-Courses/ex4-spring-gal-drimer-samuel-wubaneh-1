<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store Management - Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
</head>
<body>
<!-- Navigation Bar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/admin">⚙️ Chain Store Admin</a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/admin">📊 Dashboard</a>
            <a class="nav-link" href="/">🏠 Public Site</a>
            <a class="nav-link" href="/logout">🚪 Logout</a>
        </div>
    </div>
</nav>

<div class="container-fluid mt-4">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-2">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0">🗂️ Admin Menu</h6>
                </div>
                <div class="list-group list-group-flush">
                    <a href="/admin" class="list-group-item list-group-item-action">📊 Dashboard</a>
                    <a href="/admin/users" class="list-group-item list-group-item-action">👥 Users</a>
                    <a href="/admin/products" class="list-group-item list-group-item-action">📦 Products</a>
                    <a href="/admin/stores" class="list-group-item list-group-item-action active">🏪 Stores</a>
                    <a href="/admin/questions" class="list-group-item list-group-item-action">❓ Game Questions</a>
                    <a href="/admin/reviews" class="list-group-item list-group-item-action">💬 Reviews</a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-10">
            <!-- Page Header -->
            <div class="row mb-4">
                <div class="col-md-8">
                    <h2>🏪 Store Management</h2>
                    <p class="text-muted">Manage your store network and locations</p>
                </div>
                <div class="col-md-4 text-end">
                    <a href="/admin/stores/add" class="btn btn-success">➕ Add New Store</a>
                </div>
            </div>

            <!-- Success/Error Messages -->
            <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                <span th:text="${successMessage}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <span th:text="${errorMessage}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <!-- Filters -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">🔍 Filter Stores</h5>
                </div>
                <div class="card-body">
                    <form method="get" action="/admin/stores">
                        <div class="row">
                            <div class="col-md-3">
                                <label for="search" class="form-label">Search</label>
                                <input type="text" class="form-control" id="search" name="search"
                                       th:value="${currentSearch}" placeholder="Store name or address...">
                            </div>
                            <div class="col-md-3">
                                <label for="city" class="form-label">City</label>
                                <select class="form-select" id="city" name="city">
                                    <option value="">All Cities</option>
                                    <option th:each="cityItem : ${cities}"
                                            th:value="${cityItem}"
                                            th:text="${cityItem}"
                                            th:selected="${cityItem == currentCity}">City</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label for="state" class="form-label">State</label>
                                <select class="form-select" id="state" name="state">
                                    <option value="">All States</option>
                                    <option th:each="stateItem : ${states}"
                                            th:value="${stateItem}"
                                            th:text="${stateItem}"
                                            th:selected="${stateItem == currentState}">State</option>
                                </select>
                            </div>
                            <div class="col-md-3 d-flex align-items-end">
                                <button type="submit" class="btn btn-primary me-2">Apply Filters</button>
                                <a href="/admin/stores" class="btn btn-outline-secondary">Clear</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Stores Table -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">🏪 Store List</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Store Name</th>
                                <th>Location</th>
                                <th>Manager</th>
                                <th>Size</th>
                                <th>Features</th>
                                <th>Status</th>
                                <th>Reviews</th>
                                <th>Opened</th>
                                <th>Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="store : ${stores.content}" th:if="${stores != null and !#lists.isEmpty(stores.content)}">
                                <td th:text="${store.id}">1</td>
                                <td>
                                    <strong th:text="${store.name}">Store Name</strong><br>
                                    <small class="text-muted" th:text="${#strings.abbreviate(store.description, 40)}">Description...</small>
                                </td>
                                <td>
                                    <div>
                                        <span th:text="${store.address}">Address</span><br>
                                        <small class="text-muted" th:text="${store.city + ', ' + store.state}">City, State</small><br>
                                        <small class="text-muted" th:text="${store.zipCode}">ZIP</small>
                                    </div>
                                </td>
                                <td>
                                    <span th:text="${store.storeManager ?: '-'}">Manager</span><br>
                                    <small class="text-muted" th:if="${store.phone}" th:text="${store.phone}">Phone</small>
                                </td>
                                <td>
                                    <span th:if="${store.storeSizeSqft}" th:text="${store.storeSizeSqft + ' sq ft'}">0 sq ft</span>
                                    <span th:unless="${store.storeSizeSqft}" class="text-muted">-</span>
                                </td>
                                <td>
                                    <div class="d-flex flex-column gap-1">
                                        <span th:if="${store.parkingAvailable}" class="badge bg-success">🅿️ Parking</span>
                                        <span th:if="${store.driveThrough}" class="badge bg-info">🚗 Drive-Through</span>
                                        <span th:if="${!store.parkingAvailable and !store.driveThrough}" class="text-muted">-</span>
                                    </div>
                                </td>
                                <td>
                                        <span class="badge"
                                              th:class="${store.isActive ? 'bg-success' : 'bg-danger'}"
                                              th:text="${store.statusDisplay}">Active</span>
                                </td>
                                <td>
                                    <span class="badge bg-info" th:text="${store.approvedCommentsCount}">0</span>
                                    <span class="text-warning" th:text="${store.averageRating > 0 ? '★★★★★' : '☆☆☆☆☆'}">★★★★★</span>
                                </td>
                                <td th:text="${store.openingDate != null ? #temporals.format(store.openingDate, 'MMM dd, yyyy') : '-'}">Date</td>
                                <td>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <!-- View Store -->
                                        <a th:href="@{/stores/{id}(id=${store.id})}"
                                           class="btn btn-outline-primary"
                                           title="View Store"
                                           target="_blank">
                                            👁️
                                        </a>

                                        <!-- Edit Store -->
                                        <a th:href="@{/admin/stores/edit/{id}(id=${store.id})}"
                                           class="btn btn-warning"
                                           title="Edit Store">
                                            ✏️
                                        </a>

                                        <!-- Toggle Status -->
                                        <form th:action="@{/admin/stores/{id}/toggle-status(id=${store.id})}"
                                              method="post" style="display: inline;">
                                            <button type="submit"
                                                    class="btn"
                                                    th:class="${store.isActive ? 'btn-warning' : 'btn-success'}"
                                                    th:title="${store.isActive ? 'Deactivate Store' : 'Activate Store'}"
                                                    onclick="return confirm('Are you sure?')">
                                                <span th:if="${store.isActive}">⏸️</span>
                                                <span th:unless="${store.isActive}">▶️</span>
                                            </button>
                                        </form>

                                        <!-- Delete Store -->
                                        <form th:action="@{/admin/stores/{id}/delete(id=${store.id})}"
                                              method="post" style="display: inline;">
                                            <button type="submit"
                                                    class="btn btn-danger"
                                                    title="Delete Store"
                                                    onclick="return confirm('Are you sure you want to delete this store? This action cannot be undone.')">
                                                🗑️
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            <tr th:if="${stores == null or #lists.isEmpty(stores.content)}">
                                <td colspan="10" class="text-center text-muted">No stores found</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <nav th:if="${stores != null and (stores.hasPrevious() or stores.hasNext())}"
                         aria-label="Store pagination">
                        <ul class="pagination justify-content-center">
                            <li class="page-item" th:class="${stores.hasPrevious() ? '' : 'disabled'}">
                                <a class="page-link"
                                   th:href="@{/admin/stores(page=${stores.number - 1}, search=${currentSearch}, city=${currentCity}, state=${currentState})}">
                                    Previous
                                </a>
                            </li>
                            <li class="page-item active">
                                <span class="page-link"
                                      th:text="${stores.number + 1} + ' of ' + ${stores.totalPages}">1 of 1</span>
                            </li>
                            <li class="page-item" th:class="${stores.hasNext() ? '' : 'disabled'}">
                                <a class="page-link"
                                   th:href="@{/admin/stores(page=${stores.number + 1}, search=${currentSearch}, city=${currentCity}, state=${currentState})}">
                                    Next
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

            <!-- Store Statistics -->
            <div class="row mt-4">
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="text-primary" th:text="${stores != null ? stores.totalElements : '0'}">0</h5>
                            <small>Total Stores</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="text-success" th:text="${#lists.size(#lists.select(stores.content, 'isActive'))}">0</h5>
                            <small>Active Stores</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="text-info" th:text="${#lists.size(cities)}">0</h5>
                            <small>Cities</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="text-warning" th:text="${#lists.size(states)}">0</h5>
                            <small>States</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Store Actions -->
            <div class="row mt-4">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">🚀 Quick Store Actions</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <a href="/admin/stores/add" class="btn btn-success btn-sm w-100">➕ Add New Store</a>
                                </div>
                                <div class="col-md-4">
                                    <a href="/admin/stores?isActive=true" class="btn btn-outline-success btn-sm w-100">✅ View Active</a>
                                </div>
                                <div class="col-md-4">
                                    <a href="/admin/stores?isActive=false" class="btn btn-outline-danger btn-sm w-100">⏸️ View Inactive</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">📍 Store Features</h6>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-6">
                                    <small>With Parking:</small><br>
                                    <strong class="text-success" th:text="${#lists.size(#lists.select(stores.content, 'parkingAvailable'))}">0</strong>
                                </div>
                                <div class="col-6">
                                    <small>Drive-Through:</small><br>
                                    <strong class="text-info" th:text="${#lists.size(#lists.select(stores.content, 'driveThrough'))}">0</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>